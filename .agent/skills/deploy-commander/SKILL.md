---
name: deploy-commander
description: テスト全通過を条件としたデプロイフローの自律制御を行うスキル
---

# deploy-commander Skill

ローカルおよびクラウド環境へのデプロイを安全に実行します。デプロイ前後の健全性チェックをオートメーション化します。

## 構成
- 入力: デプロイ対象のブランチ/コミット、環境（staging/prod）
- 出力: デプロイ実行、ステータス報告

## 手順
1. **事前チェック (Pre-flight)**:
    - `pytest` を全件実行し、1つでも失敗があればデプロイを中断する。
    - `git status` を確認し、未コミットの変更がないかチェックする。
2. **デプロイ実行**:
    - プロジェクトの `Makefile` や `cloudbuild.yaml` に基づいてコマンドを実行する。
    - コマンド例: `gcloud builds submit --config cloudbuild.yaml`
3. **事後チェック (Post-flight)**:
    - デプロイ後のURLに対してヘルスチェック（`curl` 等）を実行する。
    - ログを確認し、起動エラー（CrashLoopBackOff等）がないか監視する。
4. **レポート**: 完了報告と共に、アクセスURLやデプロイIDを提示する。

## 判断基準
- テスト未実施でのデプロイは原則禁止する。
- 破壊的な変更（DBマイグレーションを含む場合）は、事前にバックアップの有無を確認する。

## 実行例
「テストが通ったらステージングに上げて」
→ `deploy-commander` が起動
→ 全テスト実行、成功を確認
→ `gcloud` コマンドでデプロイ実行
→ 完了URLを報告
